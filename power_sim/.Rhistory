files <- list.files(path = "./results_multi_knots", pattern = "\\.RDS$", full.names = TRUE)
sim_results <- do.call("rbind", lapply(files, readRDS))
sim_results = sim_results %>%
mutate(Test_id = paste0(Test, "_", Transformation))
p <- sim_results %>%
filter(Time != "categorical" | is.na(Time)) %>%
select(-Time) %>%
filter(!(Test %in% c("S4", "S1"))) %>%
group_by(Test_id, State_1, State_2) %>%
summarise(Power = round(mean(Significant_difference, na.rm = TRUE), 2)) %>%
ggplot(aes(x = Test_id, y = Power, fill = Test_id)) +
geom_col()+
ylab("Rejection rate") +
theme_minimal() +
ylim(0, 1.15) +
# geom_text(aes(label=Power), position=position_dodge(width=0.9), vjust=-0.25, size = 3) +
facet_grid(State_1~State_2) +
ggtitle("Rejection rate in pairwise testing") +
theme(axis.text.x=element_blank(),
axis.title.x=element_blank()) +
theme(plot.title = element_text(hjust = 0.5))
data_col <- sim_results %>%
group_by(Test_id, State_1, State_2) %>%
summarise(Power = round(mean(Significant_difference, na.rm = TRUE), 2)) %>%
filter(State_1 == State_2)
p +
geom_rect(data = data_col, col = "black", fill = "white", xmin = -Inf, xmax = Inf,
ymin = -Inf, ymax = Inf, alpha = 0)
sim_results %>%
filter(Time != "categorical" | is.na(Time)) %>%
select(-Time) %>%
filter(!(Test %in% c("S4", "S1"))) %>%
filter(State_1 %in% c(10, 20, 30), State_2 %in% c(10, 20, 30)) %>%
group_by(Test_id, State_1, State_2) %>%
summarise(Power = round(mean(Significant_difference, na.rm = TRUE), 2)) %>%
ggplot(aes(x = Test_id, y = Power, fill = Test_id)) +
geom_col()+
ylab("Rejection rate") +
theme_minimal() +
ylim(0, 1.15) +
# geom_text(aes(label=Power), position=position_dodge(width=0.9), vjust=-0.25, size = 3) +
facet_grid(State_1~State_2) +
ggtitle("Rejection rate in pairwise testing") +
theme(axis.text.x=element_blank(),
axis.title.x=element_blank()) +
theme(plot.title = element_text(hjust = 0.5)) +
scale_fill_brewer(palette="Paired") +
geom_label(aes(label = formatC(Power, digits = 2, width = 4)))
library(ggplot2)
library(dplyr)
library(stringr)
files <- list.files(path = "./results_multi_knots", pattern = "\\.RDS$", full.names = TRUE)
sim_results <- do.call("rbind", lapply(files, readRDS))
sim_results = sim_results %>%
mutate(Test_id = paste0(Test, "_", Transformation))
p <- sim_results %>%
filter(Time != "categorical" | is.na(Time)) %>%
select(-Time) %>%
filter(!(Test %in% c("S4", "S1"))) %>%
group_by(Test_id, State_1, State_2) %>%
summarise(Power = round(mean(Significant_difference, na.rm = TRUE), 2)) %>%
ggplot(aes(x = Test_id, y = Power, fill = Test_id)) +
geom_col()+
ylab("Rejection rate") +
theme_minimal() +
ylim(0, 1.15) +
# geom_text(aes(label=Power), position=position_dodge(width=0.9), vjust=-0.25, size = 3) +
facet_grid(State_1~State_2) +
ggtitle("Rejection rate in pairwise testing") +
theme(axis.text.x=element_blank(),
axis.title.x=element_blank()) +
theme(plot.title = element_text(hjust = 0.5))
data_col <- sim_results %>%
group_by(Test_id, State_1, State_2) %>%
summarise(Power = round(mean(Significant_difference, na.rm = TRUE), 2)) %>%
filter(State_1 == State_2)
p +
geom_rect(data = data_col, col = "black", fill = "white", xmin = -Inf, xmax = Inf,
ymin = -Inf, ymax = Inf, alpha = 0)
sim_results %>%
filter(Time != "categorical" | is.na(Time)) %>%
select(-Time) %>%
filter(!(Test %in% c("S4", "S1"))) %>%
filter(State_1 %in% c(10, 20, 30), State_2 %in% c(10, 20, 30)) %>%
group_by(Test_id, State_1, State_2) %>%
summarise(Power = round(mean(Significant_difference, na.rm = TRUE), 2)) %>%
ggplot(aes(x = Test_id, y = Power, fill = Test_id)) +
geom_col()+
ylab("Rejection rate") +
theme_minimal() +
ylim(0, 1.15) +
# geom_text(aes(label=Power), position=position_dodge(width=0.9), vjust=-0.25, size = 3) +
facet_grid(State_1~State_2) +
ggtitle("Rejection rate in pairwise testing") +
theme(axis.text.x=element_blank(),
axis.title.x=element_blank()) +
theme(plot.title = element_text(hjust = 0.5)) +
geom_label(aes(label = formatC(Power, digits = 2, width = 4)))
sim_results
sim_results %>%
filter(Time != "categorical" | is.na(Time), Test_id != "Deuteros lm_identity") %>%
select(-Time) %>%
group_by(Test_id, State_1, State_2) %>%
summarise(Power = round(mean(Significant_difference, na.rm = TRUE), 2)) %>%
ungroup() %>%
filter(State_1 == State_2 & Power >= Power[Test_id == "Deuteros lm_log"] + 0.01) %>%
mutate(timepoint = as.numeric(str_replace(str_replace(Test_id, "Spline_",  ""), "_log", ""))) %>%
select(timepoint) %>%
unique()
library(ggplot2)
library(dplyr)
library(stringr)
files <- list.files(path = "./results_multi_knots", pattern = "\\.RDS$", full.names = TRUE)
sim_results <- do.call("rbind", lapply(files, readRDS))
sim_results = sim_results %>%
mutate(Test_id = paste0(Test, "_", Transformation))
sim_results %>%
filter(Time != "categorical" | is.na(Time), Test_id != "Deuteros lm_identity") %>%
select(-Time) %>%
group_by(Test_id, State_1, State_2) %>%
summarise(Power = round(mean(Significant_difference, na.rm = TRUE), 2)) %>%
ungroup() %>%
filter(State_1 == State_2 & Power >= Power[Test_id == "Deuteros lm_log"] + 0.01) %>%
mutate(timepoint = as.numeric(str_replace(str_replace(Test_id, "Spline_",  ""), "_log", ""))) %>%
select(timepoint) %>%
unique()
sim_results %>%
filter(Time != "categorical" | is.na(Time), Test_id != "Deuteros lm_identity") %>%
select(-Time) %>%
group_by(Test_id, State_1, State_2) %>%
summarise(Power = round(mean(Significant_difference, na.rm = TRUE), 2)) %>%
ungroup() %>%
filter(State_1 == State_2 & Power >= Power[Test_id == "Deuteros lm_log"] + 0.01) %>%
mutate(timepoint = as.numeric(str_replace(str_replace(Test_id, "Spline_",  ""), "_log", "")))
sim_results %>%
filter(Time != "categorical" | is.na(Time), Test_id != "Deuteros lm_identity") %>%
select(-Time) %>%
group_by(Test_id, State_1, State_2) %>%
summarise(Power = round(mean(Significant_difference, na.rm = TRUE), 2)) %>%
ungroup() %>%
filter(State_1 == State_2 & Power <= Power[Test_id == "Deuteros lm_log"] + 0.01) %>%
mutate(timepoint = as.numeric(str_replace(str_replace(Test_id, "Spline_",  ""), "_log", ""))) %>%
select(timepoint) %>%
unique()
sim_results %>%
filter(Time != "categorical" | is.na(Time), Test_id != "Deuteros lm_identity") %>%
select(-Time) %>%
group_by(Test_id, State_1, State_2) %>%
summarise(Power = round(mean(Significant_difference, na.rm = TRUE), 2)) %>%
ungroup() %>%
filter(State_1 == State_2 & Power <= Power[Test_id == "Deuteros lm_log"] + 0.01)
sim_results %>%
filter(Time != "categorical" | is.na(Time), Test_id != "Deuteros lm_identity") %>%
select(-Time) %>%
group_by(Test_id, State_1, State_2) %>%
summarise(Power = round(mean(Significant_difference, na.rm = TRUE), 2)) %>%
ungroup() %>%
filter((State_1 == State_2 & Power <= Power[Test_id == "Deuteros lm_log"] + 0.01 | State_1 != State_2))
sim_results %>%
filter(Time != "categorical" | is.na(Time), Test_id != "Deuteros lm_identity") %>%
select(-Time) %>%
group_by(Test_id, State_1, State_2) %>%
summarise(Power = round(mean(Significant_difference, na.rm = TRUE), 2)) %>%
ungroup() %>%
filter((State_1 == State_2 & Power <= Power[Test_id == "Deuteros lm_log"] + 0.01 | (State_1 != State_2 & Power >=  Power[Test_id == "Deuteros lm_log"])))
select_results <- function(data) {
data %>%
filter(Time != "categorical" | is.na(Time), Test_id != "Deuteros lm_identity") %>%
select(-Time) %>%
group_by(Test_id, State_1, State_2) %>%
summarise(Power = round(mean(Significant_difference, na.rm = TRUE), 2)) %>%
ungroup() %>%
filter((State_1 == State_2 & Power <= Power[Test_id == "Deuteros lm_log"] + 0.01 | (State_1 != State_2 & Power >=  Power[Test_id == "Deuteros lm_log"])))
}
p <- sim_results %>%
select_results() %>%
ggplot(aes(x = Test_id, y = Power, fill = Test_id)) +
geom_col()+
ylab("Rejection rate") +
theme_minimal() +
ylim(0, 1.15) +
# geom_text(aes(label=Power), position=position_dodge(width=0.9), vjust=-0.25, size = 3) +
facet_grid(State_1~State_2) +
ggtitle("Rejection rate in pairwise testing") +
theme(axis.text.x=element_blank(),
axis.title.x=element_blank()) +
theme(plot.title = element_text(hjust = 0.5))
p
select_results <- function(data) {
data %>%
filter(Time != "categorical" | is.na(Time), Test_id != "Deuteros lm_identity") %>%
select(-Time) %>%
group_by(Test_id, State_1, State_2) %>%
summarise(Power = round(mean(Significant_difference, na.rm = TRUE), 2)) %>%
ungroup() %>%
filter((State_1 == State_2 & Power <= Power[Test_id == "Deuteros lm_log"] + 0.01))
}
p <- sim_results %>%
select_results() %>%
ggplot(aes(x = Test_id, y = Power, fill = Test_id)) +
geom_col()+
ylab("Rejection rate") +
theme_minimal() +
ylim(0, 1.15) +
# geom_text(aes(label=Power), position=position_dodge(width=0.9), vjust=-0.25, size = 3) +
facet_grid(State_1~State_2) +
ggtitle("Rejection rate in pairwise testing") +
theme(axis.text.x=element_blank(),
axis.title.x=element_blank()) +
theme(plot.title = element_text(hjust = 0.5))
p
data %>%
filter(Time != "categorical" | is.na(Time), Test_id != "Deuteros lm_identity") %>%
select(-Time) %>%
group_by(Test_id, State_1, State_2) %>%
summarise(Power = round(mean(Significant_difference, na.rm = TRUE), 2)) %>%
ungroup() %>%
filter((State_1 == State_2 & Power <= Power[Test_id == "Deuteros lm_log"] + 0.01)) %>%
left_join(data)
select_results <- function(data) {
data %>%
filter(Time != "categorical" | is.na(Time), Test_id != "Deuteros lm_identity") %>%
select(-Time) %>%
group_by(Test_id, State_1, State_2) %>%
summarise(Power = round(mean(Significant_difference, na.rm = TRUE), 2)) %>%
ungroup() %>%
filter((State_1 == State_2 & Power <= Power[Test_id == "Deuteros lm_log"] + 0.01)) %>%
left_join(data)
}
p <- sim_results %>%
select_results() %>%
ggplot(aes(x = Test_id, y = Power, fill = Test_id)) +
geom_col()+
ylab("Rejection rate") +
theme_minimal() +
ylim(0, 1.15) +
# geom_text(aes(label=Power), position=position_dodge(width=0.9), vjust=-0.25, size = 3) +
facet_grid(State_1~State_2) +
ggtitle("Rejection rate in pairwise testing") +
theme(axis.text.x=element_blank(),
axis.title.x=element_blank()) +
theme(plot.title = element_text(hjust = 0.5))
p
select_results <- function(data) {
data %>%
filter(Time != "categorical" | is.na(Time), Test_id != "Deuteros lm_identity") %>%
select(-Time) %>%
group_by(Test_id, State_1, State_2) %>%
summarise(Power = round(mean(Significant_difference, na.rm = TRUE), 2)) %>%
ungroup() %>%
filter((State_1 == State_2 & Power <= Power[Test_id == "Deuteros lm_log"] + 0.01)) %>%
left_join(data, by = c(Test_id))
}
p <- sim_results %>%
select_results() %>%
ggplot(aes(x = Test_id, y = Power, fill = Test_id)) +
geom_col()+
ylab("Rejection rate") +
theme_minimal() +
ylim(0, 1.15) +
# geom_text(aes(label=Power), position=position_dodge(width=0.9), vjust=-0.25, size = 3) +
facet_grid(State_1~State_2) +
ggtitle("Rejection rate in pairwise testing") +
theme(axis.text.x=element_blank(),
axis.title.x=element_blank()) +
theme(plot.title = element_text(hjust = 0.5))
select_results <- function(data) {
data %>%
filter(Time != "categorical" | is.na(Time), Test_id != "Deuteros lm_identity") %>%
select(-Time) %>%
group_by(Test_id, State_1, State_2) %>%
summarise(Power = round(mean(Significant_difference, na.rm = TRUE), 2)) %>%
ungroup() %>%
filter((State_1 == State_2 & Power <= Power[Test_id == "Deuteros lm_log"] + 0.01)) %>%
left_join(data, by = c("Test_id"))
}
p <- sim_results %>%
select_results() %>%
ggplot(aes(x = Test_id, y = Power, fill = Test_id)) +
geom_col()+
ylab("Rejection rate") +
theme_minimal() +
ylim(0, 1.15) +
# geom_text(aes(label=Power), position=position_dodge(width=0.9), vjust=-0.25, size = 3) +
facet_grid(State_1~State_2) +
ggtitle("Rejection rate in pairwise testing") +
theme(axis.text.x=element_blank(),
axis.title.x=element_blank()) +
theme(plot.title = element_text(hjust = 0.5))
p
data %>%
filter(Time != "categorical" | is.na(Time), Test_id != "Deuteros lm_identity") %>%
select(-Time) %>%
group_by(Test_id, State_1, State_2) %>%
summarise(Power = round(mean(Significant_difference, na.rm = TRUE), 2)) %>%
ungroup() %>%
filter((State_1 == State_2 & Power <= Power[Test_id == "Deuteros lm_log"] + 0.01))
data = sim_results
data %>%
filter(Time != "categorical" | is.na(Time), Test_id != "Deuteros lm_identity") %>%
select(-Time) %>%
group_by(Test_id, State_1, State_2) %>%
summarise(Power = round(mean(Significant_difference, na.rm = TRUE), 2)) %>%
ungroup() %>%
filter((State_1 == State_2 & Power <= Power[Test_id == "Deuteros lm_log"] + 0.01))
data %>%
filter(Time != "categorical" | is.na(Time), Test_id != "Deuteros lm_identity") %>%
select(-Time) %>%
group_by(Test_id, State_1, State_2) %>%
summarise(Power = round(mean(Significant_difference, na.rm = TRUE), 2)) %>%
ungroup() %>%
filter((State_1 == State_2 & Power <= Power[Test_id == "Deuteros lm_log"] + 0.01)) %>%
select(Test_id) %>%
unique()
data %>%
filter(Test_id %in% tests_id)
tests_id <- data %>%
filter(Time != "categorical" | is.na(Time), Test_id != "Deuteros lm_identity") %>%
select(-Time) %>%
group_by(Test_id, State_1, State_2) %>%
summarise(Power = round(mean(Significant_difference, na.rm = TRUE), 2)) %>%
ungroup() %>%
filter((State_1 == State_2 & Power <= Power[Test_id == "Deuteros lm_log"] + 0.01)) %>%
select(Test_id) %>%
unique()
data %>%
filter(Test_id %in% tests_id)
tests_id <- data %>%
filter(Time != "categorical" | is.na(Time), Test_id != "Deuteros lm_identity") %>%
select(-Time) %>%
group_by(Test_id, State_1, State_2) %>%
summarise(Power = round(mean(Significant_difference, na.rm = TRUE), 2)) %>%
ungroup() %>%
filter((State_1 == State_2 & Power <= Power[Test_id == "Deuteros lm_log"] + 0.01)) %>%
select(Test_id) %>%
unique()
data %>%
filter(Time != "categorical" | is.na(Time), Test_id != "Deuteros lm_identity") %>%
select(-Time) %>%
group_by(Test_id, State_1, State_2) %>%
summarise(Power = round(mean(Significant_difference, na.rm = TRUE), 2)) %>%
ungroup() %>%
filter((State_1 == State_2 & Power <= Power[Test_id == "Deuteros lm_log"] + 0.01)) %>%
select(Test_id) %>%
unique()
data %>%
filter(Time != "categorical" | is.na(Time), Test_id != "Deuteros lm_identity") %>%
select(-Time) %>%
group_by(Test_id, State_1, State_2) %>%
summarise(Power = round(mean(Significant_difference, na.rm = TRUE), 2)) %>%
ungroup() %>%
filter((State_1 == State_2 & Power <= Power[Test_id == "Deuteros lm_log"] + 0.01)) %>%
select(Test_id) %>%
unique() %>%
as.vector()
tests_id <- data %>%
filter(Time != "categorical" | is.na(Time), Test_id != "Deuteros lm_identity") %>%
select(-Time) %>%
group_by(Test_id, State_1, State_2) %>%
summarise(Power = round(mean(Significant_difference, na.rm = TRUE), 2)) %>%
ungroup() %>%
filter((State_1 == State_2 & Power <= Power[Test_id == "Deuteros lm_log"] + 0.01)) %>%
select(Test_id) %>%
unique() %>%
as.vector()
data %>%
filter(Test_id %in% tests_id$Test_id)
library(ggplot2)
library(dplyr)
library(stringr)
files <- list.files(path = "./results_multi_knots", pattern = "\\.RDS$", full.names = TRUE)
sim_results <- do.call("rbind", lapply(files, readRDS))
sim_results = sim_results %>%
mutate(Test_id = paste0(Test, "_", Transformation)) %>%
filter(Time != "categorical" | is.na(Time), Test_id != "Deuteros lm_identity") %>%
select(-Time) %>%
group_by(Test_id, State_1, State_2) %>%
summarise(Power = round(mean(Significant_difference, na.rm = TRUE), 2)) %>%
ungroup()
data = sim_results
tests_id <- data  %>%
filter((State_1 == State_2 & Power <= Power[Test_id == "Deuteros lm_log"] + 0.01)) %>%
select(Test_id) %>%
unique() %>%
as.vector()
tests_id
data %>%
filter(Test_id %in% tests_id$Test_id)
select_results <- function(data) {
tests_id <- data  %>%
filter((State_1 == State_2 & Power <= Power[Test_id == "Deuteros lm_log"] + 0.01)) %>%
select(Test_id) %>%
unique()
data %>%
filter(Test_id %in% tests_id$Test_id)
}
p <- sim_results %>%
select_results() %>%
ggplot(aes(x = Test_id, y = Power, fill = Test_id)) +
geom_col()+
ylab("Rejection rate") +
theme_minimal() +
ylim(0, 1.15) +
# geom_text(aes(label=Power), position=position_dodge(width=0.9), vjust=-0.25, size = 3) +
facet_grid(State_1~State_2) +
ggtitle("Rejection rate in pairwise testing") +
theme(axis.text.x=element_blank(),
axis.title.x=element_blank()) +
theme(plot.title = element_text(hjust = 0.5))
data_col <- sim_results %>%
group_by(Test_id, State_1, State_2) %>%
summarise(Power = round(mean(Significant_difference, na.rm = TRUE), 2)) %>%
filter(State_1 == State_2)
p +
geom_rect(data = data_col, col = "black", fill = "white", xmin = -Inf, xmax = Inf,
ymin = -Inf, ymax = Inf, alpha = 0)
sim_results %>%
select_results() %>%
ggplot(aes(x = Test_id, y = Power, fill = Test_id)) +
geom_col()+
ylab("Rejection rate") +
theme_minimal() +
ylim(0, 1.15) +
# geom_text(aes(label=Power), position=position_dodge(width=0.9), vjust=-0.25, size = 3) +
facet_grid(State_1~State_2) +
ggtitle("Rejection rate in pairwise testing") +
theme(axis.text.x=element_blank(),
axis.title.x=element_blank()) +
theme(plot.title = element_text(hjust = 0.5))
select_results <- function(data, diff = 0.01) {
tests_id <- data  %>%
filter((State_1 == State_2 & Power <= Power[Test_id == "Deuteros lm_log"] + diff)) %>%
select(Test_id) %>%
unique()
data %>%
filter(Test_id %in% tests_id$Test_id)
}
sim_results %>%
select_results(diff = 0) %>%
ggplot(aes(x = Test_id, y = Power, fill = Test_id)) +
geom_col()+
ylab("Rejection rate") +
theme_minimal() +
ylim(0, 1.15) +
# geom_text(aes(label=Power), position=position_dodge(width=0.9), vjust=-0.25, size = 3) +
facet_grid(State_1~State_2) +
ggtitle("Rejection rate in pairwise testing") +
theme(axis.text.x=element_blank(),
axis.title.x=element_blank()) +
theme(plot.title = element_text(hjust = 0.5))
data
data %>%
group_by(Test_id, State_1, State_2) %>%
summarise(m_power = mean(Power))
data %>%
filter(State_1 == State_2) %>%
group_by(Test_id) %>%
summarise(m_power = mean(Power))
data %>%
filter(State_1 == State_2) %>%
group_by(Test_id) %>%
summarise(m_error = mean(Power)) %>%
filter(m_error <= m_error[Test_id == "Deuteros lm_log"] + diff)
data %>%
filter(State_1 == State_2) %>%
group_by(Test_id) %>%
summarise(m_error = mean(Power))
data %>%
filter(State_1 == State_2) %>%
group_by(Test_id) %>%
summarise(m_error = mean(Power)) %>%
filter(m_error <= m_error[Test_id == "Deuteros lm_log"] + diff)
diff = 0.01
data %>%
filter(State_1 == State_2) %>%
group_by(Test_id) %>%
summarise(m_error = mean(Power)) %>%
filter(m_error <= m_error[Test_id == "Deuteros lm_log"] + diff)
tests_id <- data %>%
filter(State_1 == State_2) %>%
group_by(Test_id) %>%
summarise(m_error = mean(Power)) %>%
filter(m_error <= m_error[Test_id == "Deuteros lm_log"] + diff) %>%
select(Test_id)
tests_id
data %>%
filter(Test_id %in% tests_id$Test_id)
select_results <- function(data, diff = 0.01) {
tests_id <- data %>%
filter(State_1 == State_2) %>%
group_by(Test_id) %>%
summarise(m_error = mean(Power)) %>%
filter(m_error <= m_error[Test_id == "Deuteros lm_log"] + diff) %>%
select(Test_id)
data %>%
filter(Test_id %in% tests_id$Test_id)
}
sim_results %>%
select_results(diff = 0) %>%
ggplot(aes(x = Test_id, y = Power, fill = Test_id)) +
geom_col()+
ylab("Rejection rate") +
theme_minimal() +
ylim(0, 1.15) +
# geom_text(aes(label=Power), position=position_dodge(width=0.9), vjust=-0.25, size = 3) +
facet_grid(State_1~State_2) +
ggtitle("Rejection rate in pairwise testing") +
theme(axis.text.x=element_blank(),
axis.title.x=element_blank()) +
theme(plot.title = element_text(hjust = 0.5))
unclass(as.Date("1971-01-01"))
as.Date("1971-01-01")
